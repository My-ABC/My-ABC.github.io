# .github/workflows/update-projects.yml
name: Auto Update Projects
on:
  schedule:
    - cron: '0 * * * *'  # æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡
  workflow_dispatch:     # æ”¯æŒæ‰‹åŠ¨è§¦å‘

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Fetch ALL repositories
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          USERNAME: "My-ABC"  # ðŸ‘ˆ ä¿®æ”¹ä¸ºä½ çš„ç”¨æˆ·å
        run: |
          # èŽ·å–ç”¨æˆ·æ‰€æœ‰å…¬å¼€ä»“åº“
          curl -s -H "Authorization: token $GH_TOKEN" \
            "https://api.github.com/users/$USERNAME/repos?per_page=100" \
            | jq -r '.[].full_name' > repos.txt
          
          # ä¸ºæ¯ä¸ªä»“åº“èŽ·å–è¯¦ç»†æ•°æ®
          mkdir -p public/repos
          while read -r repo; do
            echo "Processing $repo..."
            curl -s -H "Authorization: token $GH_TOKEN" \
              "https://api.github.com/repos/$repo" > "public/repos/${repo//\//_}.json"
          done < repos.txt
          
          # ç”Ÿæˆç´¢å¼•æ–‡ä»¶
          echo '{"repos":[' > public/projects.json
          paste -sd, public/repos/*.json >> public/projects.json
          echo ']}' >> public/projects.json
          
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}